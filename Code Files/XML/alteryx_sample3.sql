-- For ToolID = "1"
WITH cte_toolID_1 AS (
    SELECT
        id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother
    FROM
        cusExSupplyTracker_ExternaSupplier
	WHERE 
        country IN ("China","United States Minor Outlying Islands") -- Condition As per ToolID="33"
    ),
	
-- For ToolID = "2"
cte_toolID_2 AS (
    SELECT
	    auditid,
		auditrecordno,
		UPPERCASE(companyname) AS companyname , -- As per ToolID = '35' specified in metainfo tag
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		department,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
 
        CASE 
			WHEN auditworkflowcurrentstatus IN ('Open', 'Closed') THEN  -- -- Condition As per ToolID = "35"
				CASE 
					WHEN DATEDIFF(day, auditdate, auditclosingdate) - 1 < 10 THEN auditid
					ELSE NULL
				END
			ELSE NULL
		END AS Audit_Date_Calcol
		
	FROM	
	    ExternalSupplyAudit
	),
	
-- JOIN Conditions       -- as per connection parameters for ToolID = "13" & ToolID = "14"
cte_ExternaSupplier_inner_join_audit AS
(
	SELECT 
        cte1.id,
		cte1.suppliername,
		cte1.supplierid,
		cte1.ecovadisid,
		cte1.cdpid,
		cte1.smdrericaid,
		cte1.smdmodifieddate,
		cte1.supplierparent,
		cte1.address,
		cte1.city,
		cte1.country,
		cte1.buyerregion,
		cte1.supplierregion,
		cte1.sector,
		cte1.curveid,
		cte1.ecomodifieddate,
		cte1.cdpmodifieddate,
		cte1.scorecard,
		cte1.scorecardbusinessunit,
		cte1.rollupsector,
		cte1.categoryfamily,
		cte1.externalsupplycategory,
		cte1.primarycategory,
		cte1.spend,
		cte1.categorystatus,
		cte1.businessunit,
		cte1.primaryplatform,
		cte1.ericastatus,
		cte1.reportingyear,
		cte1.segment,
		cte1.producttype,
		cte1.programstartyear,
		cte1.programendyear,
		cte1.program,
		cte1.ehscurrentrisk,
		cte1.laborcurrentrisk,
		cte1.ehsonsiteassess,
		cte1.onassessehsdate,
		cte1.laboronsiteassess,
		cte1.ethicslabordate,
		cte1.pieamrrisk,
		cte1.ecovatotalscore,
		cte1.ecovadisdate,
		cte1.reassessyear,
		cte1.ecovadiscoreenv,
		cte1.ecovadiscorelab,
		cte1.ecovadiscoresup,
		cte1.jjstatus,
		cte1.firesafetydate,
		cte1.informationsource,
		cte1.automatedfiredetectionandalarmsystem,
		cte1.automatedfiresuppressionsystem,
		cte1.hydrantsystem,
		cte1.twomeansofegress,
		cte1.commentsehssteam,
		cte1.commentsfiresafety,
		cte1.commentsother,
		
		cte2.auditid,
		cte2.auditrecordno,
		cte2.companyname , 
		cte2.nodeid,
		cte2.property,
		cte2.propertycode,
		cte2.audittype,
		cte2.auditsubtype,
		cte2.auditchecklist,
		cte2.auditworkflowcurrentstatus,
		cte2.auditworkflowcurrentstage,
		cte2.sitelocation,
		cte2.department,
		cte2.auditdate,
		cte2.auditor,
		cte2.thirdpartyauditors,
		cte2.siteleader,
		cte2.ehsleader,
		cte2.campusehsdirector,
		cte2.regionalehsleader,
		cte2.spoc,
		cte2.enterprisepsleader,
		cte2.segmentpsleader,
		cte2.businesspsleader,
		cte2.auditcapastatus,
		cte2.auditclosingdate,
		cte2.externalsupplierid,
		cte2.findingid,
		cte2.findingrecordno,
		cte2.findingstatus,
		cte2.datefindingclosed,
		cte2.findingdescription,
		cte2.findingpriority,
		cte2.findingauditid,
		cte2.findingsitelocation,
		cte2.findingdepartment,
		cte2.findingrepeated,
		cte2.findingregulatorynoncompliance,
		cte2.jnjstandardreference,
		cte2.closewithoutcapa,
		cte2.closewithoutcapacomments,
		cte2.reference,
		cte2.capaid,
		cte2.findrecordno,
		cte2.datecreated,
		cte2.capaassigned,
		cte2.actionno,
		cte2.capacurrentworkflowstatus,
		cte2.capacurrentworkflowstage,
		cte2.capasitelocation,
		cte2.capasubsitelocation,
		cte2.capadepartment,
		cte2.actionrequired,
		cte2.actionowner,
		cte2.actionownerreportinghierarchy,
		cte2.priority,
		cte2.requiresextensionapproval,
		cte2.targetdate,
		cte2.capacontroltype,
		cte2.capacomments,
		cte2.completioncomments,
		cte2.describeactionscompleted,
		cte2.completedby,
		cte2.completiondate,
		cte2.extensionreason,
		cte2.Audit_Date_Calcol,
		NULL as Right_id    -- as per ToolID="3" specified in meta tag
		NULL as "*Unknown"  -- as per ToolID="3" specified in meta tag 
	FROM 
		cte_toolID_1 as cte1
	INNER JOIN
		cte_toolID_2 as cte2
	ON cte1.id = cte2.externalsupplierid
),

cte_ExternaSupplier_left_join_audit AS
(
	SELECT 
        cte1.id,
		cte1.suppliername,
		cte1.supplierid,
		cte1.ecovadisid,
		cte1.cdpid,
		cte1.smdrericaid,
		cte1.smdmodifieddate,
		cte1.supplierparent,
		cte1.address,
		cte1.city,
		cte1.country,
		cte1.buyerregion,
		cte1.supplierregion,
		cte1.sector,
		cte1.curveid,
		cte1.ecomodifieddate,
		cte1.cdpmodifieddate,
		cte1.scorecard,
		cte1.scorecardbusinessunit,
		cte1.rollupsector,
		cte1.categoryfamily,
		cte1.externalsupplycategory,
		cte1.primarycategory,
		cte1.spend,
		cte1.categorystatus,
		cte1.businessunit,
		cte1.primaryplatform,
		cte1.ericastatus,
		cte1.reportingyear,
		cte1.segment,
		cte1.producttype,
		cte1.programstartyear,
		cte1.programendyear,
		cte1.program,
		cte1.ehscurrentrisk,
		cte1.laborcurrentrisk,
		cte1.ehsonsiteassess,
		cte1.onassessehsdate,
		cte1.laboronsiteassess,
		cte1.ethicslabordate,
		cte1.pieamrrisk,
		cte1.ecovatotalscore,
		cte1.ecovadisdate,
		cte1.reassessyear,
		cte1.ecovadiscoreenv,
		cte1.ecovadiscorelab,
		cte1.ecovadiscoresup,
		cte1.jjstatus,
		cte1.firesafetydate,
		cte1.informationsource,
		cte1.automatedfiredetectionandalarmsystem,
		cte1.automatedfiresuppressionsystem,
		cte1.hydrantsystem,
		cte1.twomeansofegress,
		cte1.commentsehssteam,
		cte1.commentsfiresafety,
		cte1.commentsother,
		
		cte2.auditid,
		cte2.auditrecordno,
		cte2.companyname , 
		cte2.nodeid,
		cte2.property,
		cte2.propertycode,
		cte2.audittype,
		cte2.auditsubtype,
		cte2.auditchecklist,
		cte2.auditworkflowcurrentstatus,
		cte2.auditworkflowcurrentstage,
		cte2.sitelocation,
		cte2.department,
		cte2.auditdate,
		cte2.auditor,
		cte2.thirdpartyauditors,
		cte2.siteleader,
		cte2.ehsleader,
		cte2.campusehsdirector,
		cte2.regionalehsleader,
		cte2.spoc,
		cte2.enterprisepsleader,
		cte2.segmentpsleader,
		cte2.businesspsleader,
		cte2.auditcapastatus,
		cte2.auditclosingdate,
		cte2.externalsupplierid,
		cte2.findingid,
		cte2.findingrecordno,
		cte2.findingstatus,
		cte2.datefindingclosed,
		cte2.findingdescription,
		cte2.findingpriority,
		cte2.findingauditid,
		cte2.findingsitelocation,
		cte2.findingdepartment,
		cte2.findingrepeated,
		cte2.findingregulatorynoncompliance,
		cte2.jnjstandardreference,
		cte2.closewithoutcapa,
		cte2.closewithoutcapacomments,
		cte2.reference,
		cte2.capaid,
		cte2.findrecordno,
		cte2.datecreated,
		cte2.capaassigned,
		cte2.actionno,
		cte2.capacurrentworkflowstatus,
		cte2.capacurrentworkflowstage,
		cte2.capasitelocation,
		cte2.capasubsitelocation,
		cte2.capadepartment,
		cte2.actionrequired,
		cte2.actionowner,
		cte2.actionownerreportinghierarchy,
		cte2.priority,
		cte2.requiresextensionapproval,
		cte2.targetdate,
		cte2.capacontroltype,
		cte2.capacomments,
		cte2.completioncomments,
		cte2.describeactionscompleted,
		cte2.completedby,
		cte2.completiondate,
		cte2.extensionreason,
		cte2.Audit_Date_Calcol,
		NULL as Right_id    -- as per ToolID="3" specified in meta tag
		NULL as "*Unknown"  -- as per ToolID="3" specified in meta tag 
	FROM 
		cte_toolID_1 as cte1
	LEFT JOIN
		cte_toolID_2 as cte2
	ON cte1.id = cte2.externalsupplierid
),


cte_ExternaSupplier_union_audit AS
(
SELECT 
        id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol
FROM 
    cte_ExternaSupplier_left_join_audit
    
UNION    -- -- as per ToolID = "10" specified in meta tag

SELECT 
        id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol
FROM 
    cte_ExternaSupplier_inner_join_audit
),
 
-- For ToolID = "11"  
cte_toolID_11 AS (
	SELECT
	    External_Supplier,
		Include,
		Type,
		Company
	FROM
	    External_Supply_Supplier_Attributes
    ),
	
cte_ExternaSupplier_union_audit_left_join_cte_toolID_11 AS (
    SELECT 
      id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
		NULL as "*Unknown"
		
    FROM
        cte_ExternaSupplier_union_audit as esua
	LEFT JOIN
		cte_toolID_11 as cte11
	ON 	esua.suppliername = cte11.External_Supplier
),

cte_ExternaSupplier_union_audit_inner_join_cte_toolID_11 AS (
    SELECT 
		id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
		NULL as "*Unknown"
		
    FROM
        cte_ExternaSupplier_union_audit as esua
	INNER JOIN
		cte_toolID_11 as cte11
	ON 	esua.suppliername = cte11.External_Supplier
),

cte_ExternaSupplier_union_toolID_11 AS (
    SELECT 
      id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
		
    FROM
	    cte_ExternaSupplier_union_audit_inner_join_cte_toolID_11
	
	UNION   -- as per tooldID = 13, 14 & 24 specified in connection parameters

	SELECT 
        id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company
	FROM
	    cte_ExternaSupplier_union_audit_left_join_cte_toolID_11
),

cte_toolID_28 AS (
    SELECT
	    id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		supplierparent,
		address,
		city,
		country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
		DateTimeNow() AS External_Supply_Refresh_Date   -- as per ToolID = '28'
	FROM
         cte_ExternaSupplier_union_toolID_11
),

cte_toolID_48_control_container AS (   -- as per Control Container 48
    SELECT
	    id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		country AS Reported_Country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
		NULL AS "*Unknown"
		
	FROM
         cte_ExternaSupplier_union_toolID_11
),

cte_toolID_39 AS (
    SELECT
	    id,
		suppliername,
		supplierid,
		ecovadisid,
		cdpid,
		smdrericaid,
		smdmodifieddate,
		country AS Reported_Country,
		buyerregion,
		supplierregion,
		sector,
		curveid,
		ecomodifieddate,
		cdpmodifieddate,
		scorecard,
		scorecardbusinessunit,
		rollupsector,
		categoryfamily,
		externalsupplycategory,
		primarycategory,
		spend,
		categorystatus,
		businessunit,
		primaryplatform,
		ericastatus,
		reportingyear,
		segment,
		producttype,
		programstartyear,
		programendyear,
		program,
		ehscurrentrisk,
		laborcurrentrisk,
		ehsonsiteassess,
		onassessehsdate,
		laboronsiteassess,
		ethicslabordate,
		pieamrrisk,
		ecovatotalscore,
		ecovadisdate,
		reassessyear,
		ecovadiscoreenv,
		ecovadiscorelab,
		ecovadiscoresup,
		jjstatus,
		firesafetydate,
		informationsource,
		automatedfiredetectionandalarmsystem,
		automatedfiresuppressionsystem,
		hydrantsystem,
		twomeansofegress,
		commentsehssteam,
		commentsfiresafety,
		commentsother,
		auditid,
		auditrecordno,
		companyname , 
		nodeid,
		property,
		propertycode,
		audittype,
		auditsubtype,
		auditchecklist,
		auditworkflowcurrentstatus,
		auditworkflowcurrentstage,
		sitelocation,
		cdepartment,
		auditdate,
		auditor,
		thirdpartyauditors,
		siteleader,
		ehsleader,
		campusehsdirector,
		regionalehsleader,
		spoc,
		enterprisepsleader,
		segmentpsleader,
		businesspsleader,
		auditcapastatus,
		auditclosingdate,
		externalsupplierid,
		findingid,
		findingrecordno,
		findingstatus,
		datefindingclosed,
		findingdescription,
		findingpriority,
		findingauditid,
		findingsitelocation,
		findingdepartment,
		findingrepeated,
		findingregulatorynoncompliance,
		jnjstandardreference,
		closewithoutcapa,
		closewithoutcapacomments,
		reference,
		capaid,
		findrecordno,
		datecreated,
		capaassigned,
		actionno,
		capacurrentworkflowstatus,
		capacurrentworkflowstage,
		capasitelocation,
		capasubsitelocation,
		capadepartment,
		actionrequired,
		actionowner,
		actionownerreportinghierarchy,
		priority,
		requiresextensionapproval,
		targetdate,
		capacontroltype,
		capacomments,
		completioncomments,
		describeactionscompleted,
		completedby,
		completiondate,
		extensionreason,
		Audit_Date_Calcol,
		External_Supplier,
		Include,
		Type,
		Company,
	    
	FROM 
         cte_toolID_48_control_container

),
		 
